<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js" charset="utf-8"></script>
    <script src="/socket.io/socket.io.js" charset= "utf-8"></script>
    <!----<script src="/node_modules/easytimer.js/dist/easytimer.min.js"></script> -->
    <script src="/Server/DataStructures.js"></script>
    <script src="/Server/GraphFunctionality.js"></script>

</head>
<body>
    <div id="Title">AQMS</div>
    <div>
        <canvas id="tvocChart" height="50" width="100"></canvas>  
    </div>
    <div>
        <canvas id="co2Chart" height="50" width="100"></canvas>  
    </div>> 
   <!-- Chart.js -->
   <script>
        const socket= io();
        //let timer = new Timer();
        //TVOC chart
        let counter=0;
        //timer.start({precision: 'seconds'});
socket.on("arduino:tvoc",(arduinoData)=>{
    //secondsPassed = timer.getTotalTimeValues().seconds;
    //console.log(secondsPassed);
    myChart.data.labels.push(counter);
    myChart.data.datasets.forEach(dataset => {
        dataset.data.push(arduinoData.value);
    });    
    counter++;
    if (counter > 30){
        myChart.data.labels.shift(counter);
        myChart.data.datasets.forEach(dataset => {
            dataset.data.shift(arduinoData.value);
        });    
    }
    myChart.update();
});
var ctx = document.getElementById("tvocChart").getContext('2d');
var myChart = new Chart(ctx, {
type: 'line',
data: {
labels: ["TVOC"],
datasets: [{
    label: 'tvoc',
    backgroundColor:'rgba(254, 90, 0, 0.5)',
    borderColor: 'rgba(255, 159, 64, 1)',
    borderWidth: 1,
    data: [0,5,10,15,20,25,30,35,40,45,50]
}]
},
options: {
scales: {
    yAxes: [{
        ticks: {
            beginAtZero:true
        }
    }]
}
}
});

// CO2 chart
let counterCo=0;
    socket.on("arduino:co2",(arduinoData)=>{
        //secondsPassed = timer.getTotalTimeValues().seconds;
        //console.log(secondsPassed);
       co2Chart.data.labels.push(counterCo);
       co2Chart.data.datasets.forEach(dataset => {
            dataset.data.push(arduinoData.value);
        });    
        counterCo++;
        if (counterCo > 30){
            co2Chart.data.labels.shift(counterCo);
            co2Chart.data.datasets.forEach(dataset => {
                dataset.data.shift(arduinoData.value);
            });    
        }
        co2Chart.update();
    });
    var ctx = document.getElementById("co2Chart").getContext('2d');
    var co2Chart = new Chart(ctx, {
    type: 'line',
    data: {
    labels: ["CO2"],
    datasets: [{
        label: 'co2',
        backgroundColor:'rgba(59, 99, 210, 0.5)',
        borderColor: 'rgba(31, 53, 112, 1)',
        borderWidth: 1,
        data: [0,5,10,15,20,25,30,35,40,45,50]
    }]
    },
    options: {
    scales: {
        yAxes: [{
            ticks: {
                beginAtZero:true
            }
        }]
    }
    }
    });
        </script>
</body>
</html>