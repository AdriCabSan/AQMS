<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!--FAVICON-->
    
    <link rel="apple-touch-icon" sizes="57x57" href="/images/ehecatlLogo.ico/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/ehecatlLogo.ico/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/ehecatlLogo.ico/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/ehecatlLogo.ico/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/ehecatlLogo.ico/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/ehecatlLogo.ico/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/ehecatlLogo.ico/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/ehecatlLogo.ico/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/ehecatlLogo.ico/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/ehecatlLogo.ico/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/ehecatlLogo.ico/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/ehecatlLogo.ico/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/ehecatlLogo.ico/favicon-16x16.png">
    <link rel="manifest" href="/images/ehecatlLogo.ico/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/images/ehecatlLogo.ico/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <title>Air Quality Monitoring System</title>
    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="/bootstrap-3.3.7-dist/css/bootstrap.min.css" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,700' rel='stylesheet' type='text/css'>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <!-- Custom Theme Style -->
    <link href="/css/custom.css" rel="stylesheet" type="text/css">

</head>
<body>

    <aside class="d-flex d-sm-flex d-lg-flex justify-content-center align-items-center justify-content-sm-center align-items-sm-center justify-content-lg-center align-items-lg-center justify-content-xl-center align-items-xl-center" 
    style="height: 120px;background-color: #269d9d;">
    <img class="img-fluid d-lg-flex align-self-center" src="images/LOGO.png" width="100" height="100">
    <h1 class="text-white d-lg-flex align-self-center">
        <span id="currentDate">dia-mes-año</span>
    </h1>
    </aside>

    <div class="d-xl-flex" style="margin-top: 50px;">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <div class="d-lg-flex justify-content-lg-center align-items-lg-center"><img src="images/gas.png" style="width: 100px;height: 100px;">
                        <h1 style="color: #37434d;">TVOC</h1>
                    </div>
                    
                    <div>
                        <canvas id="tvocChart"></canvas>
                    </div>

                    <div class="d-lg-flex flex-row justify-content-lg-center align-items-lg-center">
                        <strong class="d-lg-flex justify-content-lg-center align-items-lg-center">Lectura actual:&nbsp;</strong>
                        <strong><span id="maxValueTvoc">25</span></strong>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="d-lg-flex justify-content-lg-center align-items-lg-center"><img src="images/co2.png" style="width: 100px;height: 100px;">
                        <h1 style="color: #37434d;">CO2</h1>
                    </div>
                    
                    <div>
                        <canvas id="co2Chart"></canvas>
                    </div>

                    <div class="d-lg-flex flex-row justify-content-lg-center align-items-lg-center">
                        <strong class="d-lg-flex justify-content-lg-center align-items-lg-center">Lectura actual:&nbsp;</strong>
                        <strong><span id="maxValueCo2">25</span></strong>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div style="margin-top: 50px;">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <div class="d-lg-flex justify-content-lg-center align-items-lg-center"><img src="images/watering.png" style="width: 100px;height: 100px;">
                        <h1 style="color: #37434d;">Humedad</h1>
                    </div>
                   
                    <div>
                        <canvas id="humChart"></canvas>
                    </div>

                    <div class="d-lg-flex flex-row justify-content-lg-center align-items-lg-center">
                        <strong class="d-lg-flex justify-content-lg-center align-items-lg-center">Lectura actual:&nbsp;</strong>
                        <strong><span id="maxValueHum">25</span></strong>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="d-lg-flex justify-content-lg-center align-items-lg-center"><img src="images/thermometer.png" style="width: 100px;height: 100px;">
                        <h1 style="color: #444444;">Temperatura</h1>
                    </div>  
                        
                    <div>
                        <canvas id="tempChart"></canvas>
                    </div>

                    <div class="d-lg-flex flex-row justify-content-lg-center align-items-lg-center">
                        <strong class="d-lg-flex justify-content-lg-center align-items-lg-center">Lectura actual:&nbsp;</strong>
                        <strong><span id="maxValueTemp">25</span></strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="margin: 50px;">
        <h1 style="margin-bottom: 20px;">Indicadores de la calidad del aire</h1>
        <div class="d-lg-flex d-xl-flex justify-content-lg-start align-items-lg-center justify-content-xl-start align-items-xl-center"><img src="images/buena.png">
            <h2 style="color: #008751;margin-left: 20px;">Buena</h2>
        </div>
        <div class="d-lg-flex d-xl-flex justify-content-lg-start align-items-lg-center justify-content-xl-start align-items-xl-center"><img src="images/regular.png">
            <h2 style="color: #d6e80f;margin-left: 20px;">Regular</h2>
        </div>
        <div class="d-lg-flex d-xl-flex justify-content-lg-start align-items-lg-center justify-content-xl-start align-items-xl-center"><img src="images/mala.png">
            <h2 style="color: #f9603a;margin-left: 20px;">Mala</h2>
        </div>
        <div class="d-lg-flex d-xl-flex justify-content-lg-start align-items-lg-center justify-content-xl-start align-items-xl-center"><img src="images/muymala.png">
            <h2 style="color: #e8112d;margin-left: 20px;">Muy mala</h2>
        </div>
        <div class="d-lg-flex d-xl-flex justify-content-lg-start align-items-lg-center justify-content-xl-start align-items-xl-center"><img src="images/extremadamentemala.png">
            <h2 style="color: #4f2170;margin-left: 20px;">Extremadamente mala</h2>
        </div>
    </div>
    <footer class="d-flex d-md-flex justify-content-sm-center align-items-sm-center justify-content-md-center align-items-md-center" 
    style="height: 100;margin: 30px;margin-top: 100px;margin-bottom: 10px;margin-right: 0px;margin-left: 0px;">
        <strong>Copyright © AQMS 2019. Created by Ehécatl - V2.0</strong>
    </footer>
  
<!-- Latest compiled and minified JavaScript -->
<script src="/js/jquery-3.3.1.min.js"></script>
<script src="/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
<script src="/js/dates.js"></script>
<!-- Custom Theme Scripts -->
<script src="/socket.io/socket.io.js" charset= "utf-8"></script>
<!----<script src="/node_modules/easytimer.js/dist/easytimer.min.js"></script> -->
<!-- Chart.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js" charset="utf-8"></script>
   <script>
       //colors object
       const colors = {
        green:'rgba(57, 232, 0, 0.40)',
        yellow:'rgba(255, 263, 134, 0.50)',
        orange:'rgba(229, 78, 22, 0.60)',
        red: 'rgba(207, 0, 15, 0.75)',
        purple: 'rgba(142,1,142,0.90)'
    };
   //creating a plugin that draws a background color to the charts
   const Status = {
        isAcceptable: false,
        isRegular:false,
        isBad :false,
        isVeryBad : false,
        isToxic : false
    }
    let currentStatus = (Status)=>{
        let status="";
            if(Status.isAcceptable){ status = "acceptable";}
            if(Status.isRegular){ status = "regular";}
            if(Status.isBad){ status = "bad";}
            if(Status.isVeryBad){ status = "very bad";}
            if(Status.isToxic){ status = "toxic";}
        return status;
    }
    
    let tvocStatus= (data)=>{
        let status = Status
        Status.isAcceptable = data < 0.2;
        Status.isRegular = data >=0.2 && data < 3;
        Status.isBad = data >=3 && data < 15;
        Status.isVeryBad = data >=15 && data < 25;
        Status.isToxic = data > 25;
        return currentStatus(Status);
    };

    let co2Status= (data)=>{
        let status = Status
        Status.isAcceptable = data < 500;
        Status.isRegular = data >=500 && data < 600;
        Status.isBad = data >=600 && data < 700;
        Status.isVeryBad = data >=700 && data < 800;
        Status.isToxic = data >= 800;

        return currentStatus(Status);
    };
    function enviromentStatus(arduinoData,statusType){
        return statusType(arduinoData);
    }

    let setStatus=(chart,statusType,arduinoData)=>{
        if (enviromentStatus(arduinoData,statusType)=="acceptable"){
            chart.data.datasets[0].backgroundColor = colors.green;
        }
        if (enviromentStatus(arduinoData,statusType)=="regular"){
            chart.data.datasets[0].backgroundColor= colors.yellow;
        }
        if (enviromentStatus(arduinoData,statusType)=="bad"){
            chart.data.datasets[0].backgroundColor = colors.orange;
        }
        if (enviromentStatus(arduinoData,statusType)=="very bad"){
            chart.data.datasets[0].backgroundColor = colors.red;
        }
        if (enviromentStatus(arduinoData,statusType)=="toxic"){
            chart.data.datasets[0].backgroundColor = colors.purple;
        }  
    }
    function showCurrentEnviromentValue(arduinoData,maxValueType){
        let currentValue= document.getElementById(maxValueType);
        currentValue.innerHTML = arduinoData.value;
    }
        const socket= io();
//TVOC chart
        let counter=0;
socket.on("arduino:tvoc",(arduinoData)=>{
    showCurrentEnviromentValue(arduinoData,'maxValueTvoc');
    setStatus(tvocChart,tvocStatus,arduinoData.value);
    tvocChart.data.labels.push(counter);
    tvocChart.data.datasets.forEach(dataset => {
        dataset.data.push(arduinoData.value);
    });    
    counter++;
    if (counter > 13){
        tvocChart.data.labels.shift(counter);
        tvocChart.data.datasets.forEach(dataset => {
            dataset.data.shift(arduinoData.value);
        });    
    }
    tvocChart.update();
});
//TVOC chart DEFINITION
var ctx = document.getElementById("tvocChart").getContext('2d');
var tvocChart = new Chart(ctx, {
type: 'line',
data: {
labels: ["TVOC"],
datasets: [{
    label: 'ppb vs seg',
    backgroundColor:'rgba(254, 90, 0, 0.5)',
    borderColor: 'rgba(255, 159, 64, 1)',
    borderWidth: 1,
    //data: [0,5,10,15,20,25,30,35,40,45,50,55,60,70,75,80]
}]
},
options: {
scales: {
    
    yAxes: [{
        ticks: {
            beginAtZero:true
        }
    }]
}
}
});

// CO2 chart
let counterCo=0;
    socket.on("arduino:co2",(arduinoData)=>{
    showCurrentEnviromentValue(arduinoData,'maxValueCo2');
    setStatus(co2Chart,co2Status,arduinoData.value);
       co2Chart.data.labels.push(counterCo);
       co2Chart.data.datasets.forEach(dataset => {
            dataset.data.push(arduinoData.value);
        });    
        counterCo++;
        if (counterCo > 13){
            co2Chart.data.labels.shift(counterCo);
            co2Chart.data.datasets.forEach(dataset => {
                dataset.data.shift(arduinoData.value);
            });    
        }
        co2Chart.update();
    });
    // CO2 chart DEFINITION
    var ctx = document.getElementById("co2Chart").getContext('2d');
    var co2Chart = new Chart(ctx, {
    type: 'line',
    data: {
    labels: ["CO2"],
    datasets: [{
        label: 'ppm vs seg',
        backgroundColor:'rgba(59, 99, 210, 0.5)',
        borderColor: 'rgba(31, 53, 112, 1)',
        borderWidth: 1,
        //data: [400,600,800,1000,1200,1400,1600,1800,2000,2200,2400]
    }]
    },
    options: {
    responsive: true,
    scales: {
        
        yAxes: [{
            ticks: {
                beginAtZero:true
            }
        }]
    }
    }
    });

    // Humidity chart
let counterHum=0;
    socket.on("arduino:hum",(arduinoData)=>{
        showCurrentEnviromentValue(arduinoData,'maxValueHum');
        humChart.data.labels.push(counterHum);
        humChart.data.datasets.forEach(dataset => {
            dataset.data.push(arduinoData.value);
        });    
        counterHum++;
        if (counterHum > 13){
            humChart.data.labels.shift(counterHum);
            humChart.data.datasets.forEach(dataset => {
                dataset.data.shift(arduinoData.value);
            });    
        }
        humChart.update();
    });
    // Humidity chart DEFINITION
    var ctx = document.getElementById("humChart").getContext('2d');
    var humChart = new Chart(ctx, {
    type: 'line',
    data: {
    labels: ["Humidity"],
    datasets: [{
        label: '% vs seg',
        backgroundColor:'rgba(59, 99, 210, 0.5)',
        borderColor: 'rgba(31, 53, 112, 1)',
        borderWidth: 1,
        //data: [0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100]
    }]
    },
    options: {
    responsive: true,
    scales: {
        yAxes: [{
            ticks: {
                beginAtZero:true
            }
        }]
    }
    }
    });

//TEMPERATURE chart
let counterTemp=0;
    socket.on("arduino:temp",(arduinoData)=>{
        showCurrentEnviromentValue(arduinoData,'maxValueTemp');
        tempChart.data.labels.push(counterTemp);
        tempChart.data.datasets.forEach(dataset => {
            dataset.data.push(arduinoData.value);
        });    
        counterTemp++;
        if (counterTemp > 13){
            tempChart.data.labels.shift(counterTemp);
            tempChart.data.datasets.forEach(dataset => {
                dataset.data.shift(arduinoData.value);
            });    
        }
        tempChart.update();
    });
    // TEMPERATURE chart DEFINITION
    var ctx = document.getElementById("tempChart").getContext('2d');
    var tempChart = new Chart(ctx, {
    type: 'line',
    data: {
    labels: ["Temperature"],
    datasets: [{
        label: 'C° vs seg',
        backgroundColor:'rgba(59, 99, 210, 0.5)',
        borderColor: 'rgba(31, 53, 112, 1)',
        borderWidth: 1,
        //data: [-35,-30,-25,-20,-15,-10,-5,0,5,10,15,20,25,30,35]
    }]
    },
    options: {
    scales: {
        yAxes: [{
            ticks: {
                beginAtZero:true
            }
        }]
    }
    }
    });
    
        </script>
</body>
</html>